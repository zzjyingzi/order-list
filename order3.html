<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/html">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="keywords" content="运动,场馆,预约,社区,动A动,健康,保健" />
<meta name="description" content="运动健康,场馆预约,社区交友" />
<!--<meta name="viewport" content="width=device-width,minimum-scale=1.0,maximum-scale=1.0"/>-->
<title>动a动网</title>
<script type="text/javascript" src="js/jquery-1.7.2.min.js"></script>
<link rel="shortcut icon" href="favicon.ico">
<link rel="Bookmark" href="favicon.ico">
<link type="text/css" rel="stylesheet" href="css/index.css">
<script type="text/javascript">
// AddFavorite
    function AddFavorite(sURL, sTitle)
    {
        try
        { window.external.addFavorite(sURL, sTitle);}
        catch (e)
        {
            try
            {
                window.templateIdebar.addPanel(sTitle, sURL, "");
            }
            catch (e)
            {
                alert("加入收藏失败，请使用Ctrl+D进行添加");
            }
        }
    }
</script>
<!-- css3-mediaqueries.js for IE less than 9 -->
<!--[if lt IE 9]>
<script src="js/css3-mediaqueries.js"></script>
<script src="js/html5.js"></script>
<link type="text/css" rel="stylesheet" href="css/ie8_css.css">
<![endif]-->
<!--[if lte IE 8]>
<link type="text/css" rel="stylesheet" href="css/ie8_css.css">
<![endif]-->
<!--
<script src="http://css3-mediaqueries-js.googlecode.com/svn/trunk/css3-mediaqueries.js"></script>
<script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
-->
<style type="text/css">
    .del{position: absolute;top: 0;left: 100%;width: 40px;height: 20px;background-color: #099793;color: #ffffff;cursor: pointer;text-align: center;line-height: 20px;border-radius: 0 3px 3px 0;}
    .del:hover{background-color: #45B8B5;}
    .packageInfo{padding-left: 21px;}
    .packageInfo header{font-size: 16px;color: #000000;line-height: 1.5em;padding-top: 22px;}
    .packageInfo article{margin-top: 40px;}
    .priceList dd{float: left;width: 96px;line-height: 26px;padding: 15px 0; text-align: center;background-color: #daeae9;margin-top: 6px;font-weight: 600;}
    .priceList dd:not(:last-child){border-right: dotted 1px #ffffff;}
    .venuesInfo{height: auto;}
    #orderList{margin-top: 14px;}
    #orderList li{border-bottom: 1px  solid #96E2E0;padding: 10px;position: relative;}
    #orderList li:hover{background-color: #efefef;}
    #orderList li span{
        position: absolute;
        display: inline-block;
        background-color: #099793;
        width: 30px;
        height: 30px;
        right: 15px ;
        top: 10px;
        font-size: 11px;
        color: #ffffff;
        border-radius: 15px;text-align: center;line-height: 30px;
    }
    .venuesMap{width: 250px;}

    /* 小格子*/
    #cbs dd{
        display: inline-block;
        *display: inline;
        _display: inline;
        zoom: 1;
        border-radius: 4px 0;
        margin-bottom: 4px;
        margin-right: 4px;
        text-align: center;
        box-shadow: 1px 1px 2px #000000;
        /*禁止文字选择*/
        -moz-user-select: none; /*火狐*/
        -webkit-user-select: none;  /*webkit浏览器*/
        -ms-user-select: none;   /*IE10*/
        -khtml-user-select: none; /*早期浏览器*/
        -o-user-select: none;
        user-select: none;
        width:36px;
        padding-top:10px;
        height:26px;
        cursor:pointer;
    }
    .selected{
        background: #f77b01;
        color: #ffffff;
        box-shadow: inset 1px 1px 2px #666666 !important;
    }
    .bgGray{
        background-color: #cccccc;
    }
    dl, dt, dd {
        font-size: 11px;
        list-style: none outside none;
    }
    .listL li{display: inline-block;*display: inline;zoom: 1;}
    .checkBox{
        display:inline-block;
        *display: inline;
        zoom: 1;
        height: 16px;
        width: 16px;
        border:1px solid #333;
        margin:0 5px;
        text-indent:-2200em;
    }
    #timeList li{float: left;}
</style>
</head>
<body>
<section>
    <div class="standardW alignC">
        <section class="vDetailContent">
            <div class="breadcrumb">您当前的位置：<a href="#">预订场地</a>&nbsp;>&nbsp;<a href="#">爱泽恩健身俱乐部</a></div>
            <article class="right clearRight venuesMap">
                <div class="border">
                    <header></header>
                    <div class="othersVenues">其他附近场馆推荐
                        <ul>
                            <li><a href="#">远景浩泰健身俱乐部</a></li>
                        </ul>
                    </div>
                </div>
                <div id="orderList" class="border"><!--表单提交-->
                    <form name="order" id="order" action="" method="post" onsubmit="">
                        <label><input type="hidden" name="sportItemId" value="" /></label><!--运动类型-->
                        <label><input type="hidden" name="date" value="" /></label><!--日期-->
                        <ul></ul>
                        <div> 总价格：<span id="totalPrice">0</span>&nbsp;RMB</div>
                        <input type="submit" name="submit" value="提交订单" />
                    </form>
                </div>
            </article>
            <article class="venuesList clearLeft">
                <section class="venuesInfo">
                    <div class="packageInfo">
                        <article><p>
                                操作指南：首先选择日期，然后点击下方框<span  class="checkBox" style="background-color:#FFF;"></span>选择时间段和场地数量，再次点击下方<span  class="checkBox" style=" background-color:#F77B01;"></span>
                                框可取消选择，点击右侧预订按钮
                                前往支付。 每笔订单最多可选择10个场次，预订成功后将不予退换。
                                场馆声明：序号不代表实际的场地号，仅作为场地数量标识，场地号请以场馆前台安排为准。
                            </p>
                        </article>
                        <article>
                            <label for=""><!--运动种类输出部分-->
                                <select name="sportItemId" id="sportItemId">
                                    <option value="">运动类型</option>
                                </select>
                            </label>
                            <script type="text/javascript">
                                $("#sportItemId option").click(function(){

                                });
                            </script>
                        </article>
                        <article>
                            <ul id="timeList"></ul>
                            <div class="clearLeft">
                                <span class="checkBox" style="background:#ffffff;"></span>空闲
                                <span class="checkBox" style="background:#F77B01;"></span>选中
                                <span class="checkBox" style="background:#999999;"></span>已售出
                            </div>
                            <div id="cbs" class="clearLeft">
                                <dl>
                                    <dd>(元)</dd><dd>08:00</dd><dd>09:00</dd><dd>10:00</dd><dd>11:00</dd><dd>12:00</dd><dd>13:00</dd><dd>14:00</dd><dd>15:00</dd><dd>16:00</dd><dd>17:00</dd><dd>18:00</dd><dd>19:00</dd><dd>20:00</dd><dd>21:00</dd><dd>22:00</dd><dd>23:00</dd>
                                </dl>
                            </div>
                        </article>
                    </div>
                    <article></article>
                </section>
                <section class="equipment clearLeft">
                    <header>产品配置信息</header>
                    <p>活动介绍：动a动会员专享</p>
                </section>
                <section class="package clearLeft">
                    <header>产品包</header>
                    <p>预订说明：在动a动网购买本卡可享受78折优惠。</p>
                </section>
            </article>
        </section>
    </div>
</section>
<!--结尾-->
<footer class="jiewei clearBoth">
    <div class="jiewei_one">
        <a href="__URL__/requestPage/PageName/aboutUs">关于我们</a>&nbsp;&nbsp;|
        <a href="__URL__/re   questPage/PageName/useAgreement">用户使用协议</a>&nbsp;&nbsp;|
        <a href="__URL__/requestPage/PageName/joinUs">加入我们</a>&nbsp;&nbsp;|
        <a href="__URL__/requestPage/PageName/privacyPolicy">隐私政策</a>&nbsp;&nbsp;|&nbsp;&nbsp;
        <a href="__URL__/requestPage/PageName/contactUs">联系我们</a>
        <br /><br />版权所有&nbsp;&nbsp;天津亚诺天时科技有限公司&nbsp;&nbsp;<span class="red">津</span>&nbsp;ICP备<span class="gray">13004859</span>号
    </div>
</footer>

<script type="text/javascript">
    //下面添加场地的源生代码重构2014-6-5
    //2014-6-5

    //模拟日期数据
    var dataList = [
        {date:"06-05",week:"周四"},
        {date:"06-06",week:"周五"},
        {date:"06-07",week:"周六"},
        {date:"06-08",week:"周日"},
        {date:"06-09",week:"周一"},
        {date:"06-10",week:"周二"},
        {date:"06-11",week:"周三"}
    ];
    //日期列表
    var timeList = function(){
        if(document.getElementById("timeList")){
            var timeList = document.getElementById("timeList");
            var temp = document.createDocumentFragment();
            var timeUL = document.createElement("ul");
            var timeLI, enter;
            for(var i = 0; i < dataList.length;i++){
                enter = "<br />";
                timeLI = document.createElement("li");
                timeLI.innerHTML = dataList[i].date + enter + dataList[i].week;
                timeUL.appendChild(timeLI);
            }
            temp.appendChild(timeUL);
            timeList.appendChild(temp);
        }
    }();



    //attachEvent的this
    function attachEvent(target,type,handler){
        if(target.addEventListener){return target.addEventListener(type,handler,false)}
        else{
            return target.attachEvent("on"+type,
                    function(event){
                        return handler.call(target,event);
                    });
        }
    }



    //生成表格
    /*未知是否采用跨域方式
    JSONP数据使用一个函数包裹，访问格式会令有变化
    var JSONP = document.createElement("script");
    JSONP.type = "text/javascrpt";
    JSONP.src = "JSON数据地址";
    if(JSONP.src == ""){}
    JSONP.setAttribute("acc","1");
    document.getElementsByTagName("head")[0].appendChild(JSONP);*/

    /*
    下为模拟JSON数据
    从王伟处得到java输出数据时是将数据作为一个对象来输出，
    因此需要后台将数组作为这个对象的一个属性输出，
    后台写入str:来完成对返回数据的前台入口
    */
    //模板id-开始时间-结束时间-价格-剩余场地数
    var data =
            [
                {"templateId":"1","timeStar":"9","timeEnd":"11","price":"50","number":"1"},
                {"templateId":"2","timeStar":"12","timeEnd":"15","price":"100","number":"3"},
                {"templateId":"3","timeStar":"8","timeEnd":"9","price":"80","number":"4"},
                {"templateId":"4","timeStar":"10","timeEnd":"12","price":"10","number":"5"},
                {"templateId":"5","timeStar":"8","timeEnd":"9","price":"30","number":"6"},
                {"templateId":"5","timeStar":"17","timeEnd":"19","price":"20","number":"7"},
                {"templateId":"5","timeStar":"22","timeEnd":"23","price":"15","number":"8"},
                {"templateId":"6","timeStar":"14","timeEnd":"16","price":"40","number":"9"},
                {"templateId":"6","timeStar":"10","timeEnd":"11","price":"40","number":"10"},
                {"templateId":"6","timeStar":"12","timeEnd":"13","price":"40","number":"11"},
                {"templateId":"6","timeStar":"8","timeEnd":"9","price":"40","number":"12"},
                {"templateId":"7","timeStar":"10","timeEnd":"15","price":"5","number":"13"}
            ];

    //伪数据,起止时间，如无数据将使用缺省时间，
    var beginTime ,closeTime;


    //全局变量
    var orderList = document.getElementById("orderList").getElementsByTagName("ul")[0];
    var order = orderList.getElementsByTagName("li");
    var orl = document.getElementById("orderList");//订单列表
    var totalPrice = document.getElementById("totalPrice");
    var a = 0;//计数器的闭包全局变量
    var totalP = 0;   //总价
    var maxOrder = 5; //最大订购数
    var ERROR = new Array();
        ERROR[201] = "can't find the obj:";
        ERROR[202] = "type error,not:";
        ERROR[203] = "";




    //动态生成格格之有限状态版
    var placeL = function(data,element){

        var ele = document.getElementById(element);//要写入的元素
        var _data1,_data2; //2014-8-27添加define
        if(!ele)return;
        if(!data || typeof data != "object" )throw ERROR[202];

        var _ = this,                       //方便调用
            _data = data;                   //输入json数据



        if(!beginTime || !closeTime){                   //无数据将使用缺省营业时间
            try{beginTime = 8;closeTime = 23;}
            catch (e){
                console.log("no default time");
            }
        }

        //数据处理
        //将json按照属性转化为一元数组,并返回
        //data为json数据源，仅适用于 数组-对象单层数据
        //arr 为数组名，str为要检索的对象键名
        function translate(arr,data,str){
            for(var i = 0; i < data.length; i++){
                arr[i] = data[i][str];
            }
            return arr;
        }

        //数据按场地号排序
        _.serialize = function(_data){
            var exchange;
            for( var i = 0; i < _data.length - 1;i++){
                for(var j = i+1;j < _data.length ;j++){
                    if(parseInt(_data[i].price) > parseInt(_data[j].price)){
                        exchange =_data[j];
                        _data[j] = _data[i];
                        _data[i] = exchange;
                    }
                }
            }
            return _data;
        };
        _data = _.serialize(_data);//排序后单场地数据





        //返回重复数据2014-8-27添加
        _.filter1 = function(){
            var  addtion = new Array();
            for( var i = 0; i < _data.length -1;i++){
                for(var j = i+1;j < _data.length ;j++){
                    if(_data[i].price == _data[j].price){
                        addtion.push( _data[j]);
                        break; //跳出外层循环避免继续生成
                    }
                }
            }
            return addtion;
        };
        _data1 = _.filter1();


        //非重复数据添加2014-8-27添加
        _.filter2 = function(){
            for( var i = 0; i < _data.length -1;i++){
                if(_data[i].price == _data[i+1].price){
                    _data.splice(i+1,1);
                    i--;//恢复i状态，重复比较下一个
                }
            }
            return  _data;
        };
        _data2 = _.filter2();
        console.log(_data2.length);


        //数据分组，方便使用,2014-8-27 更换数据源为_data2
        _.data = {
            templateId:function(){                    //场地
                var templateId = new Array();
                return translate(templateId,_data2,"templateId");
            },
            start:function(){                   //开始时间
                var start = new Array();
                return translate(start,_data2,"timeStar");
            },
            end:function(){                     //结束时间
                var end = new Array();
                return translate(end,_data2,"timeEnd");
            },
            price:function(){                   //价格
                var price = new Array();
                return translate(price,_data2,"price");
            },
            number:function(){                   //剩余数量
                var number = new Array();
                return translate(number,_data2,"number");
            }
        };


        //生成默认方格,并写入数据
        _.insert = function(){
            var temp = document.createDocumentFragment();       //创建临时文件
            var nodeList,//行列表
                    dNode,   //行序号
                    node,    //格
                    priceL,  //场地价格
                    start,   //开始时间
                    end,     //结束时间
                    templateId,
                    number;


            //操纵表格
            for(var i = 0 ; i < _data.length; i++ ){
                start = _.data.start()[i];              //json数据起始时间
                end   = _.data.end()[i];                //json数据结束时间
                priceL = _.data.price()[i];             //价格
                number = _.data.number()[i];
                templateId = _.data.templateId()[i];            //当前模板号

                if(templateId){                 //判断是模板号
                    nodeList = createEle("dl");        //创建行
                    dNode = createEle("dd");           //创建行号
                    dNode.innerHTML = priceL;           //写入价格行号
                    nodeList.appendChild(dNode);

                    for(var j = beginTime ; j <= closeTime ; j++){     //尚无timeBegin和timeEnd数据，营业时间,需要从data()函数中获得
                        node = createEle("dd");
                        node.innerHTML = "未知";                      //缺省文本，文本类可能分为三类（未开放、已出售、价格）

                        //写入数据
                        if( j >= start && j < end){
                            node.innerHTML =  number;                    //写入剩余场地数
                            node.setAttribute("preNo","0");         //状态数据更改，模拟，使用服务器状态，如无价格将不绑定事件.
                            node.preNo = "0";
                            node.setAttribute("info",templateId + "-" + priceL + "-" + j);//写入当前场地的模板号-价格-时间
                            node.info = templateId + "-" + priceL + "-" + j;//兼容低版本IE

                        }else{
                            node.innerHTML = "已售";
                            node.className = "bgGray";
                        }
                        //写入数据结束
                        nodeList.appendChild(node);      //插入格
                    }
                    temp.appendChild(nodeList);          //插入行
                }else{
                    //重复场地数据生成格之后再处理
                }//写入数据结束
            }
            ele.appendChild(temp);                  //插入Fragment碎片
            return ele;
        }();

        //写入重复场地2014-8-27日增加
        _.duplication = function(){
            var sidList = ele.getElementsByTagName("dl");
            var timeList,start,end,info;
            for(var i = 1 ;i < sidList.length ; i ++){  //排除时间点头,取得场地数量
                timeList = sidList[i].getElementsByTagName("dd");
                for(var j = 0 ; j < _data1.length ; j++){  //查找

                    if(_data1[j].price == timeList[0].innerHTML){ //不用===判断是否价格相等

                        //当前时间段
                        start = parseInt(_data1[j].timeStar);
                        end = parseInt(_data1[j].timeEnd);

                        for(var s = start ;s < end ; s++){
                            var pEle = s - beginTime + 1;  //找到时间点
                            //写入价格
                            timeList[pEle].innerHTML = _data1[j].number;
                            //状态数据更改，模拟，使用服务器状态，如无此属性将不绑定事件.
                            timeList[pEle].setAttribute("preNo","0");
                            timeList[pEle].preNo = "0";
                            //写入场地-时间信息
                            timeList[pEle].setAttribute("info",_data1[j].templateId + "-" + _data1[j].price + "-" + s);
                            timeList[pEle].info = _data1[j].templateId + "-" + _data1[j].price + "-" + s;
                            timeList[pEle].className = "";
                        }
                    }
                }
            }
        }();
        //其他
    };
    var pride = new placeL(data,"cbs");//实例化




    //订单处理
    function handler(e,date){
        var  listLi,site,del; //创建元素容器
        if(!e)throw ERROR[201];
        var info = e.getAttribute("info")|| e.info;
        listLi = createEle("li");
        listLi.setAttribute("info",info);
        listLi.info = info;//兼容低版本IE

        info = cutStr(info);

        var innerInfo = "日期：" + date +"<br />" + "价格：" + info[1] + "&nbsp;元" +"<br />" + "数量：";//要输入的信息info[1]为时间，info[0]场地号
        listLi.innerHTML = innerInfo;

        site = createEle("span");//场地时间
        site.innerHTML = info[2] + "时"; //显示时间标号
        listLi.appendChild(site);

        creatL(listLi,"hidden","templateId",info[0]);//创建ID表单
        creatL(listLi,"number","count","1");//创建订购数量表单


        del = createEle("div");//删除单
        del.className = "del";
        del.innerHTML = "删除";
        listLi.appendChild(del);
        orderList.appendChild(listLi);
        //写入总价
        countPrice(orl,info[1]);
    }


    //创建表单元素及内容
    function creatL(ele,type,name,value){
        if(!ele && !type)return;
        var s = createEle("input");
        s.type = type;
        s.name = name;
        s.value = value;
        ele.appendChild(s);
        return ele;
    }



    var kl = document.getElementById("cbs");
    attachEvent(kl,"click",function(event){
        var e = window.event || event;
        var sEle = e.srcElement || event.target;  //当前事件元素
        var preNo = sEle.getAttribute("preNo")||sEle.preNo;//订单在订单表的位置
        var info = sEle.getAttribute("info")||sEle.info ;//订单模板-价格-时间信息
        info = cutStr(info);
        var orderList = document.getElementById("orderList");
        if(preNo){
            preNo = parseInt(preNo);
            a = a + 1;                       //计算当前场地的订单号
            handler(sEle,dataList[0].date);       //处理订单函数
            //处理原本元素
            sEle.setAttribute("preNo",a);  //支持其他浏览器
            sEle.preNo = a;                //支持IE
            function f(){return a}//计数器函数
            return f;
        }
    },false);

    //订单的点击关闭事件
    orderList.onclick = function(event){
        var e = window.event || event;
        var sEle = e.srcElement || event.target;
        var info = sEle.parentNode.getAttribute("info") || sEle.parentNode.info;
        info = cutStr(info);
        if(sEle.localName == "div"){
            sEle.parentNode.style.borderWidth = 0 ;
            sEle.parentNode.style.padding = 0;
            clear(sEle.parentNode);//清理订单
            //整理总价
            totalP = totalP - parseInt(info[1]);
            totalPrice.innerHTML = totalP;
        }
    };


    //创建元素函数
    function createEle(str){
        return  document.createElement(str);
    }

    //清理函数
    function clear(ele){
        if(!ele) return;
        ele.innerHTML = "";
    }

    //以“-”为分界切割字符串
    function cutStr(info){
        if(info){
            var arr = new Array();
            arr = info.split("-");
            return arr;
        }
    }
    //计数
    function countPrice(ele,pri){
        if(!ele)return;
        var p = ele.getElementsByTagName("div")[0];
        totalP  = totalP + parseInt(pri);
        totalPrice.innerHTML = totalP;
    }
</script>
</body>
</html>